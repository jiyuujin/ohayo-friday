---
import { Image } from '@astrojs/image/components'

import BaseHead from '../components/BaseHead.astro'
import BlogHeader from '../components/BlogHeader.astro'
import BlogFooter from '../components/BlogFooter.astro'
import BlogPost from '../components/BlogPost.astro'
import GitHubRibbon from '../components/GitHubRibbon.vue'

import '../assets/lib/customize/_article.scss'
import '../assets/lib/customize/_twitter.scss'
import '../assets/lib/_layout.scss'
import '../assets/player.scss'
import '../assets/reset.scss'
import '../assets/section.scss'
import '../assets/summary.scss'
import Icon from '../components/Icon.astro'

const { content, headings } = Astro.props
const { lang, title, explain, slug, publishDate, author, heroImage, permalink, url, alt } = content

let allPosts = await Astro.glob('../pages/posts/*.md')
allPosts = allPosts.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf())

let allIcons = [
  { name: 'github', url: 'https://github.com/jiyuujin' },
  // { name: 'hatena', url: 'https://hatena.ne.jp/' },
  { name: 'note', url: 'https://note.com/uraneko' },
  { name: 'twitter', url: 'https://twitter.com/jiyuujinlab' },
]
---

<html lang={lang || 'ja'}>
  <head>
    <BaseHead
      {title}
      description={explain}
      {permalink}
      image={`https://ohayo-ai.nekohack.me/og/${slug}.png`}
    />
    <style>
      body {
        background: rgba(167, 123, 243, 0.1);
      }

      .footer {
        position: static;
      }
    </style>
  </head>

  <body>
    <GitHubRibbon />
    <main>
      <div class="header">
        <BlogHeader {title} description={explain} />
      </div>
      <BlogPost {title} {author} {heroImage} {publishDate} {alt}>
        <div class="article">
          <div class="post-detail">
            <div style={{ textAlign: "left" }}>
              <div class="headline">{explain}</div>
            </div>
            <p style={{ margin: 0 }}>それでは、先週の主なアップデートについて振り返っていきましょう。</p>
            {headings.filter((h) => h.depth === 3).length !== 0 && (
              <div aria-label="Blog toc">
                <details class="grid">
                  <summary>目次</summary>
                  {headings
                    .filter((h) => h.depth === 3)
                    .map((h) => (
                      <p style={{ margin: 0 }}>
                        <a href={`${url}#${h.slug}`}>
                          {h.text}
                        </a>
                      </p>
                    ))}
                </details>
              </div>
            )}
            <slot />
          </div>
        </div>
      </BlogPost>
      <div aria-label="Blog recent list">
        <h2>最近 (直近 5 件) の投稿</h2>
        <div class="grid">
          {allPosts
            .slice(0, 5)
            .map((p) => (
              <p>
                <a href={p.url}>
                  {p.frontmatter.title}
                </a>
              </p>
            ))}
        </div>
      </div>
      <div class="footer">
        <BlogFooter {author} />
      </div>
    </main>
  </body>
</html>
