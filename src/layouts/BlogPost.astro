---
import { Image } from '@astrojs/image/components'

import BaseHead from '../components/BaseHead.astro'
import BlogHeader from '../components/BlogHeader.astro'
import BlogFooter from '../components/BlogFooter.astro'
import BlogPostPreview from '../components/BlogPostPreview.astro'
import BlogPost from '../components/BlogPost.astro'

import '../assets/lib/customize/_article.scss'
import '../assets/lib/customize/_twitter.scss'
import '../assets/lib/_layout.scss'
import '../assets/player.scss'
import '../assets/section.scss'
import Icon from '../components/Icon.astro'

const { content } = Astro.props
const { lang, title, explain, publishDate, author, heroImage, permalink, alt } = content

let allPosts = await Astro.glob('../pages/posts/*.md')
allPosts = allPosts.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf())
---

<html lang={lang || 'ja'}>
  <head>
    <BaseHead {title} description={explain} {permalink} />

    <style is:global>
      /* ダークモードを使わない場合 */
      body {
        background-color: #fff;
        color: #303030;
      }

      a {
        color: #303030;
      }

      main {
        background-color: transparent;
      }

      .article .post-detail h2,
      .article .post-detail h3,
      .article .post-detail h4,
      .article .post-detail p,
      .article .post-detail li,
      .article .post-detail td,
      .article .post-detail tr {
        color: #303030;
      }

      @media (prefers-color-scheme: dark) {
        .article .post-detail h2,
        .article .post-detail h3,
        .article .post-detail h4,
        .article .post-detail p,
        .article .post-detail li,
        .article .post-detail td,
        .article .post-detail tr {
          color: #303030;
        }
      }
    </style>
  </head>

  <body>
    <div class="header">
      <BlogHeader {title} description={explain} />
    </div>
    <div class="section">
      <div class="main">
        <BlogPost {title} {author} {heroImage} {publishDate} {alt}>
          <div class="article">
            <div class="post-detail">
              <div style={{ textAlign: "left", lineHeight: 2 }}>
                <div class="headline">{explain}</div>
              </div>
              <slot />
            </div>
          </div>
        </BlogPost>
      </div>
      <div class="side">
        <div class="avatar">
          <Image
            src="https://i.imgur.com/X0CcoU9.jpg"
            alt=""
            width={144}
            height={144}
          />
        </div>
        <div aria-label="Blog post list">
          <h2>最近の投稿</h2>
          <div class="grid">
            {allPosts.map((p) => <BlogPostPreview post={p} />)}
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <BlogFooter {author} />
    </div>
  </body>
</html>
